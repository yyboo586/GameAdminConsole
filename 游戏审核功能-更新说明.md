# 游戏审核功能 - 更新说明

## 📅 更新时间
2025-10-15

## 🔄 更新内容

### 1. 审核操作位置调整
**变更：** 审核操作（通过/拒绝）从列表页面移至详情页面

**原设计：**
- 列表页面显示"通过审核"和"拒绝审核"按钮
- 点击按钮弹出独立的审核对话框

**新设计：**
- 列表页面只显示"查看详情"按钮
- 在详情页面底部显示审核操作区域
- 审核操作直接在详情页面完成

**优势：**
- ✅ 用户在查看完整游戏信息后再做审核决策，更加合理
- ✅ 减少操作步骤，用户体验更流畅
- ✅ 拒绝原因输入框直接显示在详情页面，无需额外弹窗

### 2. 游戏状态类型修正
**变更：** `game.status` 类型从 `number` 改为 `string`

**涉及文件：**
- `src/views/system/tGame/review/component/model.ts`
  - `TGameReviewTableColumns.status: string`
  - `TGameReviewTableDataState.param.status: string`
  - `TGameReviewDetailState.formData.status: string`

**状态值映射：**
```
"初始状态"   ← 0
"审核中"     ← 1
"审核通过"   ← 2
"可预约"     ← 3
"已上架"     ← 4
"已下架"     ← 5
```

### 3. 详情页面增强

#### 3.1 审核操作区域（仅当状态为"审核中"时显示）
```vue
<!-- 审核操作区域 -->
<div v-if="formData.status === '审核中'">
  <h4>审核操作</h4>
  
  <!-- 通过审核按钮 -->
  <el-button type="success" @click="handleApprove">
    通过审核
  </el-button>
  
  <!-- 拒绝审核按钮 -->
  <el-button type="danger" @click="showRejectInput = true">
    拒绝审核
  </el-button>
  
  <!-- 拒绝原因输入（点击拒绝后显示） -->
  <el-form v-if="showRejectInput">
    <el-form-item label="拒绝原因" required>
      <el-input type="textarea" v-model="reviewForm.remark" />
    </el-form-item>
    <el-button type="danger" @click="handleReject">确认拒绝</el-button>
    <el-button @click="cancelReject">取消</el-button>
  </el-form>
</div>
```

#### 3.2 审核状态提示（当状态不是"审核中"时显示）
对于已审核的游戏，显示当前状态标签：
- 初始状态（灰色）
- 审核已通过（绿色）
- 可预约（蓝色）
- 已上架（绿色）
- 已下架（红色）

### 4. 交互流程优化

#### 通过审核流程：
1. 点击列表中的"查看详情"按钮
2. 查看游戏完整信息（基本信息 + 媒体文件）
3. 点击"通过审核"按钮
4. 二次确认弹窗
5. 审核完成，关闭详情页，刷新列表

#### 拒绝审核流程：
1. 点击列表中的"查看详情"按钮
2. 查看游戏完整信息
3. 点击"拒绝审核"按钮
4. **显示拒绝原因输入框**
5. 填写拒绝原因（必填）
6. 点击"确认拒绝"按钮
7. 二次确认弹窗
8. 审核完成，关闭详情页，刷新列表

### 5. 文件变更清单

#### 修改的文件：
- ✅ `src/views/system/tGame/review/component/model.ts` - 类型定义更新
- ✅ `src/views/system/tGame/review/component/detail.vue` - 集成审核操作
- ✅ `src/views/system/tGame/review/index.vue` - 简化列表操作

#### 删除的文件：
- ❌ `src/views/system/tGame/review/component/review.vue` - 不再需要独立的审核对话框

## 🎨 UI 改进

### 详情页面布局
```
┌────────────────────────────────────────┐
│  游戏审核详情                            │
├────────────────────────────────────────┤
│  [基本信息区域]                          │
│  - 游戏名称、分类、标签                   │
│  - 开发商、发行商                        │
│  - 游戏描述、详情                        │
├────────────────────────────────────────┤
│  [媒体文件区域]                          │
│  - 游戏图标                              │
│  - 游戏截图                              │
│  - 游戏视频                              │
│  - APK 文件                             │
├────────────────────────────────────────┤
│  [审核操作区域] (仅审核中状态显示)        │
│  ┌──────────────────────────────────┐  │
│  │  审核操作                         │  │
│  │  [通过审核] [拒绝审核]             │  │
│  │                                   │  │
│  │  拒绝原因输入框 (点击拒绝后显示)    │  │
│  │  ┌──────────────────────────┐    │  │
│  │  │ 请输入拒绝原因...         │    │  │
│  │  └──────────────────────────┘    │  │
│  │  [确认拒绝] [取消]                │  │
│  └──────────────────────────────────┘  │
└────────────────────────────────────────┘
```

### 样式特点
- 审核操作区域使用浅色背景区分
- 按钮使用大号尺寸（`size="large"`）
- 通过审核使用绿色（`type="success"`）
- 拒绝审核使用红色（`type="danger"`）
- 按钮平分布局（`flex: 1`）

## 🔧 技术要点

### 1. 表单验证
```typescript
// 拒绝原因必填验证
:rules="[{ required: true, message: '请输入拒绝原因', trigger: 'blur' }]"
```

### 2. 状态管理
```typescript
const showRejectInput = ref(false);  // 控制拒绝原因输入框显示
const reviewForm = reactive({
  remark: ''  // 拒绝原因
});
```

### 3. 事件通信
```typescript
// 详情组件触发列表刷新
emits('refreshList');

// 父组件监听
@refreshList="getReviewList"
```

### 4. 二次确认
```typescript
ElMessageBox.confirm('确认通过该游戏的审核？', '提示', {
  confirmButtonText: '确认',
  cancelButtonText: '取消',
  type: 'warning',
})
```

## ✅ 测试要点

### 功能测试
1. ✅ 查看详情能正常打开
2. ✅ 审核中状态显示审核操作区域
3. ✅ 非审核中状态显示状态标签
4. ✅ 通过审核功能正常
5. ✅ 拒绝审核输入框能正常显示/隐藏
6. ✅ 拒绝原因必填验证生效
7. ✅ 拒绝审核功能正常
8. ✅ 审核后列表自动刷新
9. ✅ 媒体文件正常显示

### 类型检查
- ✅ 所有文件通过 TypeScript 类型检查
- ✅ 无 linter 错误

## 📝 使用说明

### 审核员操作流程
1. 进入"游戏审核"菜单
2. 查看待审核游戏列表
3. 点击"查看详情"查看游戏完整信息
4. 查看游戏基本信息和媒体文件
5. 做出审核决策：
   - **通过**：直接点击"通过审核" → 确认
   - **拒绝**：点击"拒绝审核" → 填写原因 → 确认拒绝
6. 审核完成后自动返回列表

## ⚠️ 注意事项

1. **状态类型**：确保后端接口返回的 `status` 字段为字符串类型
2. **拒绝原因**：拒绝审核时必须填写拒绝原因
3. **权限控制**：建议只给管理员角色分配审核权限
4. **二次确认**：所有审核操作都需要用户二次确认

## 🚀 后续优化建议

1. 添加审核历史记录功能
2. 支持审核意见模板（快速选择常见拒绝原因）
3. 添加审核时长统计
4. 支持审核进度跟踪
5. 添加审核结果通知（邮件/站内信）

---

**版本**: v1.1.0  
**状态**: ✅ 已完成  
**测试**: ✅ 已通过类型检查








