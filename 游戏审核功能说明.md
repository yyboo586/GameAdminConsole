# 游戏审核功能说明文档

## 一、功能概述

游戏审核模块用于管理员审核开发者提交的游戏。开发者设置游戏基本信息后提交审核，只有审核通过后游戏才能上架或开放预约。

## 二、文件结构

新创建的文件位于以下目录：

```
src/views/system/tGame/review/
├── component/
│   ├── model.ts          # 类型定义文件
│   ├── detail.vue        # 审核详情展示对话框
│   └── review.vue        # 审核操作（通过/拒绝）对话框
└── index.vue             # 审核列表主页面
```

## 三、API 接口

在 `src/api/system/tGame.ts` 中添加了以下接口：

1. **getReviewList(query)** - 获取待审核游戏列表
   - 接口地址：`GET /api/v1/game-engine/games/in-review`
   - 支持分页和搜索参数

2. **approveGame(id, data)** - 审核通过
   - 接口地址：`POST /api/v1/game-engine/games/{id}/approve`
   - 参数：`{ remark: string }` - 审核备注（可选）

3. **rejectGame(id, data)** - 审核拒绝
   - 接口地址：`POST /api/v1/game-engine/games/{id}/reject`
   - 参数：`{ remark: string }` - 拒绝原因（必填）

## 四、路由配置

### 4.1 路由路径建议

由于项目使用**后端控制路由**，需要在后端系统菜单管理中添加以下配置：

**菜单配置建议：**
- **路由路径（path）**: `/system/tGame/review`
- **组件路径（component）**: `system/tGame/review/index`
- **菜单名称**: `游戏审核`
- **父级菜单**: `游戏管理` （与游戏列表同级）
- **图标（icon）**: `ele-Check` 或 `iconfont icon-shenhe`
- **排序**: 建议放在游戏列表之后

### 4.2 路由配置示例（后端菜单表）

```sql
INSERT INTO sys_menu (
    parent_id,      -- 游戏管理的菜单ID
    name,           -- 游戏审核
    path,           -- /system/tGame/review
    component,      -- system/tGame/review/index
    icon,           -- ele-Check
    sort,           -- 排序值
    type,           -- 菜单类型（目录/菜单/按钮）
    is_hide,        -- 0
    is_cache,       -- 1
    status          -- 1
) VALUES (
    '游戏管理菜单ID',
    '游戏审核',
    '/system/tGame/review',
    'system/tGame/review/index',
    'ele-Check',
    2,
    'M',
    0,
    1,
    1
);
```

### 4.3 权限配置

如果需要按钮级别的权限控制，可以添加以下权限标识：
- `api/v1/game-engine/games/in-review:query` - 查看审核列表
- `api/v1/game-engine/games/approve:post` - 审核通过
- `api/v1/game-engine/games/reject:post` - 审核拒绝

## 五、功能特性

### 5.1 审核列表页面
- ✅ 展示所有待审核的游戏
- ✅ 支持按游戏名称搜索
- ✅ 支持分页显示
- ✅ 显示游戏基本信息（名称、分类、标签、开发商、发行商、状态、提交时间）
- ✅ 提供查看详情、通过审核、拒绝审核三个操作

### 5.2 审核详情对话框
- ✅ 展示游戏完整信息
- ✅ 按类型分组展示媒体文件：
  - 游戏图标（150x150）
  - 游戏截图（200x120，支持预览）
  - 游戏视频（400x225，支持播放）
  - APK文件（提供下载链接）

### 5.3 审核操作对话框
- ✅ 通过审核：可选填写审核备注
- ✅ 拒绝审核：必须填写拒绝原因
- ✅ 操作完成后自动刷新列表

## 六、游戏状态流转

```
0: 初始状态
    ↓
1: 审核中 ← 开发者提交审核
    ↓
2: 审核通过 ← 管理员批准
    ↓
3: 可预约 ← 设置为可预约状态
    ↓
4: 已上架 ← 正式上架
    ↓
5: 已下架 ← 下架
```

**审核功能关注的状态：**
- 审核列表主要显示**状态=1（审核中）**的游戏
- 审核通过后，游戏状态变更为**状态=2（审核通过）**
- 审核拒绝后，游戏状态回到**状态=0（初始状态）**

## 七、使用流程

### 开发者端（游戏列表页面）：
1. 创建游戏并填写基本信息
2. 上传媒体文件（图标、截图、视频、APK等）
3. 点击"提交审核"按钮
4. 游戏状态变更为"审核中"

### 管理员端（游戏审核页面）：
1. 进入"游戏审核"菜单
2. 查看待审核游戏列表
3. 点击"查看详情"查看游戏完整信息
4. 根据审核结果：
   - 点击"通过审核"并可选填写备注
   - 点击"拒绝审核"并必填拒绝原因
5. 确认操作后，游戏状态自动更新

## 八、注意事项

1. **路由配置**：由于项目使用后端控制路由，必须在后端系统的菜单管理中添加对应的菜单项。

2. **权限控制**：建议为审核功能设置独立的权限，只有管理员角色才能访问。

3. **接口地址**：确保后端接口地址与 API 文件中定义的一致。当前配置的基础地址为 `http://127.0.0.1:9800`，生产环境需要修改。

4. **状态同步**：审核操作完成后会自动刷新列表，确保状态实时更新。

5. **必填项验证**：拒绝审核时必须填写拒绝原因，否则无法提交。

## 九、快速测试

完成路由配置后，可以按以下步骤测试：

1. 登录管理员账号
2. 访问"游戏管理" > "游戏审核"菜单
3. 查看待审核游戏列表
4. 点击任意游戏的"查看详情"查看完整信息
5. 测试"通过审核"和"拒绝审核"功能
6. 确认操作后游戏从审核列表中移除

## 十、后续扩展建议

1. **审核历史记录**：记录每次审核的操作人、操作时间、审核意见
2. **审核统计**：展示审核通过率、平均审核时长等数据
3. **批量审核**：支持一次审核多个游戏
4. **审核流程**：支持多级审核机制
5. **消息通知**：审核结果通知开发者

---

## 联系信息

如有问题，请联系开发团队。

